<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>麻瓜吃菜鸟</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-03-07T12:56:00.894Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Joden He</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>[转载] 获取被代理类的真实类</title>
    <link href="http://yoursite.com/2019/03/07/Java/spring/target-class/"/>
    <id>http://yoursite.com/2019/03/07/Java/spring/target-class/</id>
    <published>2019-03-07T12:29:17.151Z</published>
    <updated>2019-03-07T12:56:00.894Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>版权说明，文章转载自 <a href="http://imushan.com/2017/03/13/java/spring/Spring%E7%AC%94%E8%AE%B0-%E8%8E%B7%E5%8F%96%E8%A2%AB%E4%BB%A3%E7%90%86%E7%9A%84%E7%9C%9F%E5%AE%9E%E7%B1%BB/" target="_blank" rel="noopener">Spring 笔记-获取被代理的真实类</a></p></blockquote><p>对一个 <code>Autowired</code> 进来的类调用 <code>getClass</code>，发现得到的类是: <code>com.xxx.search.provider.service.SearchServiceImpl$$EnhancerBySpringCGLIB$$129db519</code>，一看就不是正经类。从名字中可以看出，这个是被代理后的类，可能因为这个类被AOP了吧。但是我在反射操作是需要原始的类的信息，要如何得到呢？</p><p><code>org.springframework.aop</code> 下有一个很重要的接口: <code>TargetClassAware</code>, 这个接口表示目前这个类是被代理的。所以我们可以通过判断一个实例是否是 <code>TargetClassAware</code> 的实例来判断他是否是一个代理类。而且 <code>TargetClassAware</code> 接口提供了 <code>getTargetClass</code> 方法来获取真实类。可以这么用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (aInstance <span class="keyword">instanceof</span> TargetClassAware) &#123;</span><br><span class="line">    aInstance.getTargetClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不过更推荐的做法是使用 <code>org.springframework.aop.support.AopUtils</code> 提供的 <code>getTargetClass</code> 方法来获取真实类。可以看看其源码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; getTargetClass(Object candidate) &#123;</span><br><span class="line">    Assert.notNull(candidate, <span class="string">"Candidate object must not be null"</span>);</span><br><span class="line">    Class result = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(candidate <span class="keyword">instanceof</span> TargetClassAware) &#123;</span><br><span class="line">        result = ((TargetClassAware)candidate).getTargetClass();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(result == <span class="keyword">null</span>) &#123;</span><br><span class="line">        result = isCglibProxy(candidate)?candidate.getClass().getSuperclass():candidate.getClass();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码首先判断当前类是否是 <code>TargetClassAware</code> 的实现，如果是，调用 <code>getTargetClass</code>，方法还判断当前类是否是 <code>CglibProxy</code>，如果是基于 <code>cglib</code> 的代理类，因为是基于继承来实现代理，所以获取父类就是真实类了。</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://stackoverflow.com/questions/2289211/obtain-real-class-object-for-spring-bean" target="_blank" rel="noopener">java - Obtain real Class object for Spring bean - Stack Overflow</a></li><li><a href="http://docs.spring.io/spring/docs/3.0.x/javadoc-api/org/springframework/aop/support/AopUtils.html#getTargetClass(java.lang.Object" target="_blank" rel="noopener">AopUtils</a>)</li></ul>]]></content>
    
    <summary type="html">
    
      有时候我们使用 getClass 获取到的类是被代理的类而不是真实的类，那我们是怎么获取到真实的类的呢？
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
      <category term="Spring" scheme="http://yoursite.com/categories/Java/Spring/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="Spring" scheme="http://yoursite.com/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>oracle cloud 如何获取图片 url</title>
    <link href="http://yoursite.com/2019/02/20/oracle-cloud/how-to-get-image-url/"/>
    <id>http://yoursite.com/2019/02/20/oracle-cloud/how-to-get-image-url/</id>
    <published>2019-02-20T13:22:56.636Z</published>
    <updated>2019-02-20T13:28:58.459Z</updated>
    
    <content type="html"><![CDATA[<p>以获取物料图片 <code>url</code> 作为例子</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">SELECT</span> (<span class="keyword">decode</span>(datatype_code,</span><br><span class="line">                <span class="string">'FILE'</span>,</span><br><span class="line">                (:p_host || <span class="string">'/cs/idcplg?IdcService=GET_FILE&amp;dID='</span>) || dm_version_number,</span><br><span class="line">                <span class="string">'WEB_PAGE'</span>,</span><br><span class="line">                <span class="keyword">url</span>)) <span class="keyword">AS</span> image</span><br><span class="line"> <span class="keyword">FROM</span> fnd_attached_documents d,</span><br><span class="line"> fnd_documents_vl       dv</span><br><span class="line"> <span class="keyword">WHERE</span> d.document_id = d.document_id</span><br><span class="line"> <span class="keyword">AND</span> d.entity_name = <span class="string">'ITEM_ENTITY'</span></span><br><span class="line"> <span class="keyword">AND</span> d.pk1_value = to_char(esi.organization_id)</span><br><span class="line"> <span class="keyword">AND</span> d.pk2_value = to_char(esi.inventory_item_id)</span><br><span class="line"> <span class="keyword">AND</span> <span class="keyword">rownum</span> = <span class="number">1</span>) <span class="keyword">AS</span> item_photo</span><br></pre></td></tr></table></figure><blockquote><p> 其中 <code>p_host</code> 为 <code>cloud</code> 的主域名</p></blockquote><p>其他类型的图片 <code>url</code> 可以通过变换 <code>d.entity_name = &#39;ITEM_ENTITY&#39;</code> 进行查找</p>]]></content>
    
    <summary type="html">
    
      oracle cloud 中通过附件来管理图片信息，其中图片信息可以是外链 url, 也可以是上传图片信息，cloud 生成链接信息。
    
    </summary>
    
      <category term="Oracle Cloud" scheme="http://yoursite.com/categories/Oracle-Cloud/"/>
    
    
      <category term="Oracle Cloud" scheme="http://yoursite.com/tags/Oracle-Cloud/"/>
    
      <category term="attachment" scheme="http://yoursite.com/tags/attachment/"/>
    
  </entry>
  
  <entry>
    <title>如何获取 oracle cloud 的 PO 的 shipping method</title>
    <link href="http://yoursite.com/2019/02/20/oracle-cloud/po/how-to-get-shipping-method/"/>
    <id>http://yoursite.com/2019/02/20/oracle-cloud/po/how-to-get-shipping-method/</id>
    <published>2019-02-20T13:12:38.137Z</published>
    <updated>2019-02-20T13:20:20.028Z</updated>
    
    <content type="html"><![CDATA[<h3 id="版本信息"><a href="#版本信息" class="headerlink" title="版本信息"></a>版本信息</h3><h3 id="example"><a href="#example" class="headerlink" title="example"></a>example</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> po_bip_helper.get_shipping_method(carrierpartyname.party_name,</span><br><span class="line">                                         modeoftransportlookuppeo.meaning,</span><br><span class="line">                                         servicelevellookuppeo.meaning) <span class="keyword">AS</span> shippingmethod</span><br><span class="line">  <span class="keyword">FROM</span> wsh_carriers   carrier,</span><br><span class="line">       hz_parties     carrierpartyname,</span><br><span class="line">       fnd_lookups    modeoftransportlookuppeo,</span><br><span class="line">       fnd_lookups    servicelevellookuppeo,</span><br><span class="line">       po_headers_all header</span><br><span class="line"> <span class="keyword">WHERE</span> (header.mode_of_transport = modeoftransportlookuppeo.lookup_code(+) <span class="keyword">AND</span> modeoftransportlookuppeo.lookup_type(+) = <span class="string">'WSH_MODE_OF_TRANSPORT'</span>)</span><br><span class="line">   <span class="keyword">AND</span> (header.service_level = servicelevellookuppeo.lookup_code(+) <span class="keyword">AND</span> servicelevellookuppeo.lookup_type(+) = <span class="string">'WSH_SERVICE_LEVELS'</span>)</span><br><span class="line">   <span class="keyword">AND</span> header.carrier_id = carrier.carrier_id(+)</span><br><span class="line">   <span class="keyword">AND</span> carrier.carrier_id = carrierpartyname.party_id(+)</span><br><span class="line">   <span class="keyword">AND</span> header.segment1 = <span class="string">'20000028'</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Oracle Cloud PO 界面上显示的 shipping method 在后台是通过几个字段来存储的，要获取该字段得使用函数获取。
    
    </summary>
    
      <category term="Oracle Cloud" scheme="http://yoursite.com/categories/Oracle-Cloud/"/>
    
      <category term="PO" scheme="http://yoursite.com/categories/Oracle-Cloud/PO/"/>
    
    
      <category term="Oracle Cloud" scheme="http://yoursite.com/tags/Oracle-Cloud/"/>
    
      <category term="PO" scheme="http://yoursite.com/tags/PO/"/>
    
  </entry>
  
  <entry>
    <title>如何获取 oracle cloud 的 Match Approval Level</title>
    <link href="http://yoursite.com/2019/02/20/oracle-cloud/how-to-get-match-approval-level/"/>
    <id>http://yoursite.com/2019/02/20/oracle-cloud/how-to-get-match-approval-level/</id>
    <published>2019-02-20T04:55:51.995Z</published>
    <updated>2019-02-20T13:09:42.230Z</updated>
    
    <content type="html"><![CDATA[<h3 id="版本信息"><a href="#版本信息" class="headerlink" title="版本信息"></a>版本信息</h3><p><strong>Oracle Cloud Application</strong></p><p><strong>Revision 13.18.10 (11.13.18.10.0)</strong></p><table><thead><tr><th>Title</th><th>Description</th></tr></thead><tbody><tr><td>Oracle Application Development Framework</td><td>JDEVADF_11.1.1.9.2ADF-REL131810-PROD-BP_GENERIC_181116.1437.7206</td></tr><tr><td>Oracle Middleware Extensions for Applications</td><td>ATGPF_PT.REL13.18.10_GENERIC_181113.1603.REL13BP16.7</td></tr><tr><td>Database Compatibility</td><td>TRUE (REL13BP16.7)</td></tr></tbody></table><h3 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h3><ul><li><p>When Receipt Required Flag is N, then Match Approval level is 2 way.</p></li><li><p>When Receipt Required Flag is Y and Inspection Required Flag is N, then Match Approval Level is 3 way.</p></li><li><p>When Receipt Required Flag is Y and Inspection Required Flag is Y, then Match Approval Level is 4 way.</p></li></ul><blockquote><p>2-way 不需要检测收货 receipt_required_flag 为 N</p><p>3-way 需要在 match invoice 的时候验收货 所以 receipt_required_flag 为Y , inspection_required_flag 为 N</p><p>4-way 还要检测验货 所以 两个都为 Y</p></blockquote><h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">decode(poz_supplier_sites_v.receipt_required_flag,</span><br><span class="line">       'Y',</span><br><span class="line">       decode(poz_supplier_sites_v.inspection_required_flag,</span><br><span class="line">              'Y',</span><br><span class="line">              '4-Way',</span><br><span class="line">              'N',</span><br><span class="line">              '3-Way'),</span><br><span class="line">       'N',</span><br><span class="line">       '2-Way') AS matching_level</span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://j178.mtgbb.com/?p=713" target="_blank" rel="noopener">http://j178.mtgbb.com/?p=713</a></p>]]></content>
    
    <summary type="html">
    
      oracle cloud 中后台表是通过 receipt_required_flag inspection_required_flag 两个字段的关系获取 Match Approval Level 的值，po, supplier, supplier site 获取的原理同样
    
    </summary>
    
      <category term="Oracle Cloud" scheme="http://yoursite.com/categories/Oracle-Cloud/"/>
    
    
      <category term="Oracle Cloud" scheme="http://yoursite.com/tags/Oracle-Cloud/"/>
    
      <category term="Match Approval Level" scheme="http://yoursite.com/tags/Match-Approval-Level/"/>
    
  </entry>
  
  <entry>
    <title>Gitlab 更新 fork 的代码</title>
    <link href="http://yoursite.com/2019/02/18/git/gitlab-update-fork/"/>
    <id>http://yoursite.com/2019/02/18/git/gitlab-update-fork/</id>
    <published>2019-02-18T08:44:55.363Z</published>
    <updated>2019-02-18T09:02:23.724Z</updated>
    
    <content type="html"><![CDATA[<h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><ul><li>先确定是否建立了主仓库的远程数据源:</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote -v</span><br></pre></td></tr></table></figure><p><img src="/images/6.png" alt="remote_rep"></p><p>我们发现只有我们自己的两个源(fetch 和 push)，那这个时候就需要添加主仓库的源。</p><ul><li>添加主仓库的源</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add upstream URL</span><br></pre></td></tr></table></figure><blockquote><p>upstream : 随便起的名字</p><p>URL： fork的仓库地址</p><p>如果想删除remote的upstream标签，则可以运行： git remote rm upstream</p></blockquote><p><img src="/images/7.png" alt="remote_rep"></p><ul><li><p>更新代码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git fetch upstream</span><br><span class="line">git checkout master</span><br><span class="line">git merge upstream/master</span><br></pre></td></tr></table></figure></li></ul><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://blog.csdn.net/lhh1113/article/details/71038154" target="_blank" rel="noopener">https://blog.csdn.net/lhh1113/article/details/71038154</a></p>]]></content>
    
    <summary type="html">
    
      有时候我们在 gitlab fork 了某个项目的代码，然而我们需要怎么更新我们 fork 的代码呢？
    
    </summary>
    
      <category term="git" scheme="http://yoursite.com/categories/git/"/>
    
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>JSTACK 分析线程</title>
    <link href="http://yoursite.com/2019/02/11/Java/jstack-cpu/"/>
    <id>http://yoursite.com/2019/02/11/Java/jstack-cpu/</id>
    <published>2019-02-11T11:23:18.746Z</published>
    <updated>2019-02-16T06:54:52.536Z</updated>
    
    <content type="html"><![CDATA[<h3 id="查找-tomcat-线程"><a href="#查找-tomcat-线程" class="headerlink" title="查找 tomcat 线程"></a>查找 tomcat 线程</h3><p>可以通过两种方式找：</p><ul><li><p>jps</p><p>一般Bootstrap都是tomcat的</p><p><img src="/images/1.png" alt="JPS"></p></li></ul><ul><li><p>ps -ef |grep tomcat</p><p><img src="/images/2.png" alt="PS"></p></li></ul><h3 id="jstack-dump-出线程"><a href="#jstack-dump-出线程" class="headerlink" title="jstack dump 出线程"></a>jstack dump 出线程</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack 23524 &gt; jstack.txt</span><br></pre></td></tr></table></figure><h3 id="查看-tomcat-内部线程"><a href="#查看-tomcat-内部线程" class="headerlink" title="查看 tomcat 内部线程"></a>查看 tomcat 内部线程</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top -H -p 23524</span><br></pre></td></tr></table></figure><blockquote><p>（shift+p 按 cpu 排序，shift+m 按内存排序） </p></blockquote><p><img src="/images/3.png" alt="tomcat-stack"></p><h3 id="将PID换算成16进制，然后在jstack-txt查找nid-0x换算后的数"><a href="#将PID换算成16进制，然后在jstack-txt查找nid-0x换算后的数" class="headerlink" title="将PID换算成16进制，然后在jstack.txt查找nid=0x换算后的数"></a>将PID换算成16进制，然后在jstack.txt查找nid=0x换算后的数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat jstack.txt | grep 'nid=0x5be9' -B 5 -A 40</span><br></pre></td></tr></table></figure><p><img src="/images/4.png" alt="4.png"></p><blockquote><p>发现频繁的GC，推测是不是数据库在频繁的开关导致，因此检查 tomcat jndi是否没配置数据库连接池参数</p></blockquote><h3 id="加上连接池参数"><a href="#加上连接池参数" class="headerlink" title="加上连接池参数"></a>加上连接池参数</h3><p><img src="/images/5.png" alt="5.png"></p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>jstack分析cpu负载过高原因：</p><p><a href="https://blog.csdn.net/u010248330/article/details/80080605" target="_blank" rel="noopener">https://blog.csdn.net/u010248330/article/details/80080605</a></p><p>jstack: Java占用高CPU分析之- GC Task Thread:</p><p><a href="https://blog.csdn.net/chenxiusheng/article/details/74007040" target="_blank" rel="noopener">https://blog.csdn.net/chenxiusheng/article/details/74007040</a></p>]]></content>
    
    <summary type="html">
    
      CPU 占用100%，如何根据 java 线程情况定位到问题所在
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="Jstack" scheme="http://yoursite.com/tags/Jstack/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis 传入参数为 List、Array、Map</title>
    <link href="http://yoursite.com/2019/02/08/Java/MyBatis/mybatis-collection-params/"/>
    <id>http://yoursite.com/2019/02/08/Java/MyBatis/mybatis-collection-params/</id>
    <published>2019-02-08T13:17:09.265Z</published>
    <updated>2019-02-08T14:54:52.567Z</updated>
    
    <content type="html"><![CDATA[<h3 id="foreach-标签简单介绍"><a href="#foreach-标签简单介绍" class="headerlink" title="foreach 标签简单介绍"></a>foreach 标签简单介绍</h3><p>主要用于在SQL语句中构建循环体</p><p>标签的主要属性有 <code>item</code>，<code>index</code>，<code>collection</code>，<code>open</code>，<code>separator</code>，<code>close</code>。</p><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>item</td><td>集合中每一个元素进行迭代时的别名。该参数为必选。</td></tr><tr><td>index</td><td>指定一个名字，用于表示在迭代过程中，没错迭代到的位置</td></tr><tr><td>open</td><td>表示该语句以什么开始</td></tr><tr><td>close</td><td>表示该语句以什么结束</td></tr><tr><td>separator</td><td>表示在每次进行迭代之间以什么符号作为分隔符</td></tr><tr><td>collection</td><td>属性是在使用foreach的时候最关键的也是最容易出错的，该属性是必须指定的，但是在不同情况下，该属性的值是不一样的，主要有一下3种情况： <br>(1) 如果传入的是单参数且参数类型是一个List的时候，collection属性值为list .<br>(2) 如果传入的是单参数且参数类型是一个array数组的时候，collection的属性值为array .<br>(3) 如果传入的参数是多个的时候，我们就需要把它们封装成一个Map了，当然单参数也可以封装成map，实际上如果你在传入参数的时候，在MyBatis里面也是会把它封装成一个Map的，map的key就是参数名，所以这个时候collection属性值就是传入的List或array对象在自己封装的map里面的key.<br>(4) 如果参数使用了@Param注解，那必须是参数名</td></tr></tbody></table><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><h4 id="建表语句"><a href="#建表语句" class="headerlink" title="建表语句"></a>建表语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`XXGL_CODE_COMBINATIONS`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`XXGL_CODE_COMBINATIONS`</span>(</span><br><span class="line">    <span class="string">`COMBINATION_ID`</span> <span class="built_in">bigint</span> AUTO_INCREMENT <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'表ID，主键，供其他表做外键'</span> ,</span><br><span class="line">    <span class="string">`CODE_COMBINATION_ID`</span>  <span class="built_in">bigint</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">`ENABLED_FLAG`</span>  <span class="built_in">varchar</span>(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'Y/N'</span> ,</span><br><span class="line">    <span class="string">`ACCOUNT_TYPE`</span>  <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'账户类型'</span> ,</span><br><span class="line">    <span class="string">`SEGMENT1`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值1'</span>,</span><br><span class="line">    <span class="string">`SEGMENT2`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值2'</span>,</span><br><span class="line">    <span class="string">`SEGMENT3`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值3'</span>,</span><br><span class="line">    <span class="string">`SEGMENT4`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值4'</span>,</span><br><span class="line">    <span class="string">`SEGMENT5`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值5'</span>,</span><br><span class="line">    <span class="string">`SEGMENT6`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值6'</span>,</span><br><span class="line">    <span class="string">`SEGMENT7`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值7'</span>,</span><br><span class="line">    <span class="string">`SEGMENT8`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值8'</span>,</span><br><span class="line">    <span class="string">`SEGMENT9`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值9'</span>,</span><br><span class="line">    <span class="string">`SEGMENT10`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值10'</span>,</span><br><span class="line">    <span class="string">`SEGMENT11`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值11'</span>,</span><br><span class="line">    <span class="string">`SEGMENT12`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值12'</span>,</span><br><span class="line">    <span class="string">`SEGMENT13`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值13'</span>,</span><br><span class="line">    <span class="string">`SEGMENT14`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值14'</span>,</span><br><span class="line">    <span class="string">`SEGMENT15`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值15'</span>,</span><br><span class="line">    <span class="string">`SEGMENT16`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值16'</span>,</span><br><span class="line">    <span class="string">`SEGMENT17`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值17'</span>,</span><br><span class="line">    <span class="string">`SEGMENT18`</span>  <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'段值18'</span>,</span><br><span class="line">    </span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`COMBINATION_ID`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`XXGL_CODE_COMBINATIONS_U1`</span> (<span class="string">`COMBINATION_ID`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`XXGL_CODE_COMBINATIONS_N1`</span> (<span class="string">`CODE_COMBINATION_ID`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1000</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure><h4 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`XXGL_CODE_COMBINATIONS`</span> (</span><br><span class="line"><span class="string">`CODE_COMBINATION_ID`</span>,</span><br><span class="line"><span class="string">`ENABLED_FLAG`</span>,</span><br><span class="line"><span class="string">`ACCOUNT_TYPE`</span>,</span><br><span class="line"><span class="string">`SEGMENT1`</span>,</span><br><span class="line"><span class="string">`SEGMENT2`</span>,</span><br><span class="line"><span class="string">`SEGMENT3`</span>,</span><br><span class="line"><span class="string">`SEGMENT4`</span>,</span><br><span class="line"><span class="string">`SEGMENT5`</span>,</span><br><span class="line"><span class="string">`SEGMENT6`</span>,</span><br><span class="line"><span class="string">`SEGMENT7`</span>,</span><br><span class="line"><span class="string">`SEGMENT8`</span>,</span><br><span class="line"><span class="string">`SEGMENT9`</span>,</span><br><span class="line"><span class="string">`SEGMENT10`</span>,</span><br><span class="line"><span class="string">`SEGMENT11`</span>,</span><br><span class="line"><span class="string">`SEGMENT12`</span>,</span><br><span class="line"><span class="string">`SEGMENT13`</span>,</span><br><span class="line"><span class="string">`SEGMENT14`</span>,</span><br><span class="line"><span class="string">`SEGMENT15`</span>,</span><br><span class="line"><span class="string">`SEGMENT16`</span>,</span><br><span class="line"><span class="string">`SEGMENT17`</span>,</span><br><span class="line"><span class="string">`SEGMENT18`</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(</span><br><span class="line"><span class="number">300000003238305</span>,</span><br><span class="line"><span class="string">'Y'</span>,</span><br><span class="line"><span class="string">'E'</span>,</span><br><span class="line"><span class="string">'050'</span>,</span><br><span class="line"><span class="string">'0'</span>,</span><br><span class="line"><span class="string">'71205'</span>,</span><br><span class="line"><span class="string">'S101005'</span>,</span><br><span class="line"><span class="string">'50010'</span>,</span><br><span class="line"><span class="string">'1101'</span>,</span><br><span class="line"><span class="string">'I101'</span>,</span><br><span class="line"><span class="string">'0'</span>,</span><br><span class="line"><span class="string">'0'</span>,</span><br><span class="line"><span class="string">'0'</span>,</span><br><span class="line"><span class="string">'0'</span>,</span><br><span class="line"><span class="string">'0'</span>,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line"><span class="literal">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="实体类（CodeCombinations-java）"><a href="#实体类（CodeCombinations-java）" class="headerlink" title="实体类（CodeCombinations.java）"></a>实体类（CodeCombinations.java）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.Length;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by xiaofeng.he on 2018/03/08</span></span><br><span class="line"><span class="comment"> * 帐号组合DTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"XXGL_CODE_COMBINATIONS"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeCombinations</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Long combinationId; <span class="comment">// 表ID，主键，供其他表做外键</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> Long codeCombinationId; <span class="comment">// ERP中CODE_COMBINATION_ID</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accountType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String enabledFlag;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment3;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment4;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment5;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment6;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment7;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment8;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment9;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment10;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment11;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment12;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment13;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment14;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment15;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment16;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment17;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">private</span> String segment18;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getter setter...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="java-mapper"><a href="#java-mapper" class="headerlink" title="java mapper"></a>java mapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by xiaofeng.he on 2018/03/08</span></span><br><span class="line"><span class="comment"> * 账户组合mapper</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CodeCombinationsMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据多个 segment value 查询唯一</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> segmentValues</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">CodeCombinations <span class="title">selectOneBySegmentArray</span><span class="params">(@Param(<span class="string">"segmentValues"</span>)</span> String[] segmentValues)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据多个 segment value 查询唯一</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> segmentValues</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">CodeCombinations <span class="title">selectOneBySegmentList</span><span class="params">(List&lt;String&gt; segmentValues)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据多个 segment value 查询唯一</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">CodeCombinations <span class="title">selectOneBySegmentMap</span><span class="params">(Map&lt;String, Object&gt; params)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="xml-mapper"><a href="#xml-mapper" class="headerlink" title="xml mapper"></a>xml mapper</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"xxx.mapper.CodeCombinationsMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"xxx.dto.CodeCombinations"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"COMBINATION_ID"</span> <span class="attr">property</span>=<span class="string">"combinationId"</span> <span class="attr">jdbcType</span>=<span class="string">"DECIMAL"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"CODE_COMBINATION_ID"</span> <span class="attr">property</span>=<span class="string">"codeCombinationId"</span> <span class="attr">jdbcType</span>=<span class="string">"DECIMAL"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"ACCOUNT_TYPE"</span> <span class="attr">property</span>=<span class="string">"accountType"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"ENABLED_FLAG"</span> <span class="attr">property</span>=<span class="string">"enabledFlag"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT1"</span> <span class="attr">property</span>=<span class="string">"segment1"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT2"</span> <span class="attr">property</span>=<span class="string">"segment2"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT3"</span> <span class="attr">property</span>=<span class="string">"segment3"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT4"</span> <span class="attr">property</span>=<span class="string">"segment4"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT5"</span> <span class="attr">property</span>=<span class="string">"segment5"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT6"</span> <span class="attr">property</span>=<span class="string">"segment6"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT7"</span> <span class="attr">property</span>=<span class="string">"segment7"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT8"</span> <span class="attr">property</span>=<span class="string">"segment8"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT9"</span> <span class="attr">property</span>=<span class="string">"segment9"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT10"</span> <span class="attr">property</span>=<span class="string">"segment10"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT11"</span> <span class="attr">property</span>=<span class="string">"segment11"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT12"</span> <span class="attr">property</span>=<span class="string">"segment12"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT13"</span> <span class="attr">property</span>=<span class="string">"segment13"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT14"</span> <span class="attr">property</span>=<span class="string">"segment14"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT15"</span> <span class="attr">property</span>=<span class="string">"segment15"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT16"</span> <span class="attr">property</span>=<span class="string">"segment16"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT17"</span> <span class="attr">property</span>=<span class="string">"segment17"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SEGMENT18"</span> <span class="attr">property</span>=<span class="string">"segment18"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!--Array:forech 中的 collection 属性类型是 Array, collection 的值必须是:array, item 的值可以随意, mapper 接口中参数名字随意 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectOneBySegmentArray"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">        select c.* from XXGL_CODE_COMBINATIONS c</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            and c.ENABLED_FLAG = 'Y'</span><br><span class="line">            <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"segmentValues"</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 使用了@Param 后collection不能填array，要填写别名 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"segmentValues"</span> <span class="attr">item</span>=<span class="string">"segmentValue"</span> <span class="attr">index</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">                        and c.SEGMENT$&#123;index+1&#125; = #&#123;segmentValue&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                    and 1=2</span><br><span class="line">                <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--List:forech 中的 collection 属性类型是 List, collection 的值必须是:list, item 的值可以随意, mapper 接口中参数名字随意 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectOneBySegmentList"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">        select c.* from XXGL_CODE_COMBINATIONS c</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            and c.ENABLED_FLAG = 'Y'</span><br><span class="line">            <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"segmentValue"</span> <span class="attr">index</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">                        and c.SEGMENT$&#123;index+1&#125; = #&#123;segmentValue&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                    and 1=2</span><br><span class="line">                <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--Map:不单单 forech 中的 collection 属性是 map.key,其它所有属性都是 map.key, 比如下面的 enabledFlag --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectOneBySegmentMap"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">        select c.* from XXGL_CODE_COMBINATIONS c</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            and c.ENABLED_FLAG = #&#123;enabledFlag&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"segmentArray"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"segmentArray"</span> <span class="attr">item</span>=<span class="string">"segmentValue"</span> <span class="attr">index</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">                        and c.SEGMENT$&#123;index+1&#125; = #&#123;segmentValue&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                    and 1=2</span><br><span class="line">                <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"segmentList"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"segmentList"</span> <span class="attr">item</span>=<span class="string">"segmentValue"</span> <span class="attr">index</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">                        /* 2 */</span><br><span class="line">                        and c.SEGMENT$&#123;index+1&#125; = #&#123;segmentValue&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                    and 1=2</span><br><span class="line">                <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="测试-controller"><a href="#测试-controller" class="headerlink" title="测试 controller"></a>测试 controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> xxx.dto.CodeCombinations;</span><br><span class="line"><span class="keyword">import</span> xxx.mapper.CodeCombinationsMapper;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CodeCombinationsMapper codeCombinationsMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/test/code/combination/selectBySegments"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CodeCombinations&gt; <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String[] a = &#123;<span class="string">"050"</span>, <span class="string">"0"</span>, <span class="string">"71205"</span>, <span class="string">"S101005"</span>, <span class="string">"50010"</span>, <span class="string">"1101"</span>, <span class="string">"I101"</span>&#125;;</span><br><span class="line"></span><br><span class="line">        CodeCombinations codeCombinations1 = codeCombinationsMapper.selectOneBySegments(a);</span><br><span class="line">        CodeCombinations codeCombinations2 = codeCombinationsMapper.selectOneBySegmentList(Arrays.asList(a));</span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">"enabledFlag"</span>, <span class="string">"Y"</span>);</span><br><span class="line">        params.put(<span class="string">"segmentArray"</span>, a);</span><br><span class="line">        params.put(<span class="string">"segmentList"</span>, Arrays.asList(a));</span><br><span class="line">        CodeCombinations codeCombinations3 = codeCombinationsMapper.selectOneBySegmentMap(params);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(codeCombinations1, codeCombinations2, codeCombinations3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h4><p><strong>log</strong></p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">08</span> <span class="number">22</span>:<span class="number">40</span>:<span class="number">40</span><span class="variable">.523</span> DEBUG [<span class="number">10001</span>] [e5c47fa7c79b461a806c2d6135d485c2] xxx<span class="variable">.mapper</span><span class="variable">.CodeCombinationsMapper</span><span class="variable">.selectOneBySegments</span> - ==&gt;  Preparing: select c.* from XXGL_CODE_COMBINATIONS c WHERE c<span class="variable">.ENABLED_FLAG</span> = 'Y' <span class="keyword">and</span> c<span class="variable">.SEGMENT1</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT2</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT3</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT4</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT5</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT6</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT7</span> = ? </span><br><span class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">08</span> <span class="number">22</span>:<span class="number">40</span>:<span class="number">40</span><span class="variable">.524</span> DEBUG [<span class="number">10001</span>] [e5c47fa7c79b461a806c2d6135d485c2] xxx<span class="variable">.mapper</span><span class="variable">.CodeCombinationsMapper</span><span class="variable">.selectOneBySegments</span> - ==&gt; Parameters: <span class="number">050</span>(String), <span class="number">0</span>(String), <span class="number">71205</span>(String), S101005(String), <span class="number">50010</span>(String), <span class="number">1101</span>(String), I101(String)</span><br><span class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">08</span> <span class="number">22</span>:<span class="number">40</span>:<span class="number">40</span><span class="variable">.532</span> DEBUG [<span class="number">10001</span>] [e5c47fa7c79b461a806c2d6135d485c2] xxx<span class="variable">.mapper</span><span class="variable">.CodeCombinationsMapper</span><span class="variable">.selectOneBySegments</span> - &lt;==      Total: <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">08</span> <span class="number">22</span>:<span class="number">40</span>:<span class="number">43</span><span class="variable">.259</span> DEBUG [<span class="number">10001</span>] [e5c47fa7c79b461a806c2d6135d485c2] xxx<span class="variable">.mapper</span><span class="variable">.CodeCombinationsMapper</span><span class="variable">.selectOneBySegmentList</span> - ==&gt;  Preparing: select c.* from XXGL_CODE_COMBINATIONS c WHERE c<span class="variable">.ENABLED_FLAG</span> = 'Y' <span class="keyword">and</span> c<span class="variable">.SEGMENT1</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT2</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT3</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT4</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT5</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT6</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT7</span> = ? </span><br><span class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">08</span> <span class="number">22</span>:<span class="number">40</span>:<span class="number">43</span><span class="variable">.259</span> DEBUG [<span class="number">10001</span>] [e5c47fa7c79b461a806c2d6135d485c2] xxx<span class="variable">.mapper</span><span class="variable">.CodeCombinationsMapper</span><span class="variable">.selectOneBySegmentList</span> - ==&gt; Parameters: <span class="number">050</span>(String), <span class="number">0</span>(String), <span class="number">71205</span>(String), S101005(String), <span class="number">50010</span>(String), <span class="number">1101</span>(String), I101(String)</span><br><span class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">08</span> <span class="number">22</span>:<span class="number">40</span>:<span class="number">43</span><span class="variable">.263</span> DEBUG [<span class="number">10001</span>] [e5c47fa7c79b461a806c2d6135d485c2] xxx<span class="variable">.mapper</span><span class="variable">.CodeCombinationsMapper</span><span class="variable">.selectOneBySegmentList</span> - &lt;==      Total: <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">08</span> <span class="number">22</span>:<span class="number">40</span>:<span class="number">44</span><span class="variable">.284</span> DEBUG [<span class="number">10001</span>] [e5c47fa7c79b461a806c2d6135d485c2] xxx<span class="variable">.mapper</span><span class="variable">.CodeCombinationsMapper</span><span class="variable">.selectOneBySegmentMap</span> - ==&gt;  Preparing: select c.* from XXGL_CODE_COMBINATIONS c WHERE c<span class="variable">.ENABLED_FLAG</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT1</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT2</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT3</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT4</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT5</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT6</span> = ? <span class="keyword">and</span> c<span class="variable">.SEGMENT7</span> = ? <span class="comment">/* 2 */</span> <span class="keyword">and</span> c<span class="variable">.SEGMENT1</span> = ? <span class="comment">/* 2 */</span> <span class="keyword">and</span> c<span class="variable">.SEGMENT2</span> = ? <span class="comment">/* 2 */</span> <span class="keyword">and</span> c<span class="variable">.SEGMENT3</span> = ? <span class="comment">/* 2 */</span> <span class="keyword">and</span> c<span class="variable">.SEGMENT4</span> = ? <span class="comment">/* 2 */</span> <span class="keyword">and</span> c<span class="variable">.SEGMENT5</span> = ? <span class="comment">/* 2 */</span> <span class="keyword">and</span> c<span class="variable">.SEGMENT6</span> = ? <span class="comment">/* 2 */</span> <span class="keyword">and</span> c<span class="variable">.SEGMENT7</span> = ? </span><br><span class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">08</span> <span class="number">22</span>:<span class="number">40</span>:<span class="number">44</span><span class="variable">.284</span> DEBUG [<span class="number">10001</span>] [e5c47fa7c79b461a806c2d6135d485c2] xxx<span class="variable">.mapper</span><span class="variable">.CodeCombinationsMapper</span><span class="variable">.selectOneBySegmentMap</span> - ==&gt; Parameters: Y(String), <span class="number">050</span>(String), <span class="number">0</span>(String), <span class="number">71205</span>(String), S101005(String), <span class="number">50010</span>(String), <span class="number">1101</span>(String), I101(String), <span class="number">050</span>(String), <span class="number">0</span>(String), <span class="number">71205</span>(String), S101005(String), <span class="number">50010</span>(String), <span class="number">1101</span>(String), I101(String)</span><br><span class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">08</span> <span class="number">22</span>:<span class="number">40</span>:<span class="number">44</span><span class="variable">.289</span> DEBUG [<span class="number">10001</span>] [e5c47fa7c79b461a806c2d6135d485c2] xxx<span class="variable">.mapper</span><span class="variable">.CodeCombinationsMapper</span><span class="variable">.selectOneBySegmentMap</span> - &lt;==      Total: <span class="number">1</span></span><br></pre></td></tr></table></figure><p><strong>json</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">"combinationId"</span>: <span class="number">1000</span>,</span><br><span class="line"><span class="attr">"codeCombinationId"</span>: <span class="number">300000003238305</span>,</span><br><span class="line"><span class="attr">"accountType"</span>: <span class="string">"E"</span>,</span><br><span class="line"><span class="attr">"enabledFlag"</span>: <span class="string">"Y"</span>,</span><br><span class="line"><span class="attr">"segment1"</span>: <span class="string">"050"</span>,</span><br><span class="line"><span class="attr">"segment2"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment3"</span>: <span class="string">"71205"</span>,</span><br><span class="line"><span class="attr">"segment4"</span>: <span class="string">"S101005"</span>,</span><br><span class="line"><span class="attr">"segment5"</span>: <span class="string">"50010"</span>,</span><br><span class="line"><span class="attr">"segment6"</span>: <span class="string">"1101"</span>,</span><br><span class="line"><span class="attr">"segment7"</span>: <span class="string">"I101"</span>,</span><br><span class="line"><span class="attr">"segment8"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment9"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment10"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment11"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment12"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment13"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment14"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment15"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment16"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment17"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment18"</span>: <span class="literal">null</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">"combinationId"</span>: <span class="number">1000</span>,</span><br><span class="line"><span class="attr">"codeCombinationId"</span>: <span class="number">300000003238305</span>,</span><br><span class="line"><span class="attr">"accountType"</span>: <span class="string">"E"</span>,</span><br><span class="line"><span class="attr">"enabledFlag"</span>: <span class="string">"Y"</span>,</span><br><span class="line"><span class="attr">"segment1"</span>: <span class="string">"050"</span>,</span><br><span class="line"><span class="attr">"segment2"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment3"</span>: <span class="string">"71205"</span>,</span><br><span class="line"><span class="attr">"segment4"</span>: <span class="string">"S101005"</span>,</span><br><span class="line"><span class="attr">"segment5"</span>: <span class="string">"50010"</span>,</span><br><span class="line"><span class="attr">"segment6"</span>: <span class="string">"1101"</span>,</span><br><span class="line"><span class="attr">"segment7"</span>: <span class="string">"I101"</span>,</span><br><span class="line"><span class="attr">"segment8"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment9"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment10"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment11"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment12"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment13"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment14"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment15"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment16"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment17"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment18"</span>: <span class="literal">null</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">"combinationId"</span>: <span class="number">1000</span>,</span><br><span class="line"><span class="attr">"codeCombinationId"</span>: <span class="number">300000003238305</span>,</span><br><span class="line"><span class="attr">"accountType"</span>: <span class="string">"E"</span>,</span><br><span class="line"><span class="attr">"enabledFlag"</span>: <span class="string">"Y"</span>,</span><br><span class="line"><span class="attr">"segment1"</span>: <span class="string">"050"</span>,</span><br><span class="line"><span class="attr">"segment2"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment3"</span>: <span class="string">"71205"</span>,</span><br><span class="line"><span class="attr">"segment4"</span>: <span class="string">"S101005"</span>,</span><br><span class="line"><span class="attr">"segment5"</span>: <span class="string">"50010"</span>,</span><br><span class="line"><span class="attr">"segment6"</span>: <span class="string">"1101"</span>,</span><br><span class="line"><span class="attr">"segment7"</span>: <span class="string">"I101"</span>,</span><br><span class="line"><span class="attr">"segment8"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment9"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment10"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment11"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment12"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"segment13"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment14"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment15"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment16"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment17"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"segment18"</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h3><p><a href="https://blog.csdn.net/s592652578/article/details/52871884" target="_blank" rel="noopener">https://blog.csdn.net/s592652578/article/details/52871884</a></p>]]></content>
    
    <summary type="html">
    
      MyBatis 传入参数为 List、Array、Map
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
      <category term="MyBatis" scheme="http://yoursite.com/categories/Java/MyBatis/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="MyBatis" scheme="http://yoursite.com/tags/MyBatis/"/>
    
  </entry>
  
  <entry>
    <title>航天信息金税盘接口 js 调用</title>
    <link href="http://yoursite.com/2018/12/02/essay/gold-tax-js/"/>
    <id>http://yoursite.com/2018/12/02/essay/gold-tax-js/</id>
    <published>2018-12-02T14:28:42.420Z</published>
    <updated>2019-02-08T13:13:45.251Z</updated>
    
    <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><blockquote><p>最近项目要求与单机版的金税盘接口进行对接，在这里简单记录一下自己的开发经验，希望可以帮助到有需要的人</p><p>PS：接口使用 <code>js</code> 对接，仅支持 <code>ie</code> 浏览器。</p></blockquote><h3 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h3><p>在进行开发时候需要有一些前置条件</p><ol><li><p><code>ie</code> 浏览器</p><ul><li><p>开启 <code>activeX</code> 控件</p><p>设置 –&gt; Internet 选项 –&gt; 安全 –&gt; 自定义级别</p><p>把 <code>activeX</code> 相关设置勾上</p><p>可参考: </p></li><li><p>管理员身份运行调试</p><p>如果开票软件安装到本地 <code>C盘</code> 需要使用管理员打开 <code>ie</code> 浏览器，然后再进行调试</p></li></ul></li><li><p>金税盘安装</p><ul><li>要确保金税盘安装准确安装了<code>TaxCardX.dll</code></li></ul></li></ol><h3 id="通用-js代码"><a href="#通用-js代码" class="headerlink" title="通用 js代码"></a>通用 <code>js</code>代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 航信金税盘相关function */</span></span><br><span class="line"><span class="keyword">var</span> goldTax = &#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用前先判断是否是ie浏览器</span></span><br><span class="line"><span class="comment"> * @return true/false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">isIE: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!!<span class="built_in">window</span>.ActiveXObject || <span class="string">"ActiveXObject"</span> <span class="keyword">in</span> <span class="built_in">window</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开启金税盘</span></span><br><span class="line"><span class="comment"> * @param certPassword 单机版为证书口令  服务器版为地址 留空则读取开票BIN文件下cert.txt</span></span><br><span class="line"><span class="comment"> * @return </span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *        'success': true/false, // 成功或者失败</span></span><br><span class="line"><span class="comment"> *        'code': -1/其他, // 错误码，-1 为系统错误</span></span><br><span class="line"><span class="comment"> *        'msg': 'xxx', // 错误信息</span></span><br><span class="line"><span class="comment"> *        'data': &#123;&#125; // 接口返回相关数据</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">openCard: <span class="function"><span class="keyword">function</span> (<span class="params">certPassword</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> result = &#123;</span><br><span class="line"><span class="string">'success'</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">'code'</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="string">'msg'</span>: <span class="string">''</span>,</span><br><span class="line"><span class="string">'data'</span>: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            goldTax.card = <span class="keyword">new</span> ActiveXObject(<span class="string">"TaxCardX.GoldTax"</span>);</span><br><span class="line">            <span class="comment">// 单机版为证书口令  服务器版为地址 留空则读取开票BIN文件下cert.txt</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">typeof</span> certPassword != <span class="string">'undefined'</span>) &#123;</span><br><span class="line">            goldTax.card.CertPassword = certPassword;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 开启金税盘</span></span><br><span class="line">            goldTax.card.OpenCard();</span><br><span class="line">            result.code = goldTax.card.RetCode;</span><br><span class="line">            result.msg = goldTax.card.RetMsg;</span><br><span class="line">            <span class="comment">// 1011 开启成功</span></span><br><span class="line">            <span class="keyword">if</span> (result.code == <span class="number">1011</span>) &#123;</span><br><span class="line">            result.success = <span class="literal">true</span>;</span><br><span class="line">            result.data = &#123;</span><br><span class="line">            RetCode: goldTax.card.RetCode, <span class="comment">/* RetCode - 状态码， 1011 开启成功 */</span></span><br><span class="line">            RetMsg: goldTax.card.RetMsg, <span class="comment">/* RetMsg 状态信息 */</span></span><br><span class="line">            InvLimit: goldTax.card.InvLimit, <span class="comment">/* InvLimit – 开票限额, 金税卡发票开具价税合计限额 */</span></span><br><span class="line">            TaxCode: goldTax.card.TaxCode, <span class="comment">/* TaxCode 本单位税号 */</span></span><br><span class="line">            TaxClock: goldTax.card.TaxClock, <span class="comment">/* TaxClock – 金税卡时钟 */</span></span><br><span class="line">            MachineNo: goldTax.card.MachineNo, <span class="comment">/* MachineNo – 开票机号码，主开票机为 0 */</span></span><br><span class="line">            IsInvEmpty: goldTax.card.IsInvEmpty, <span class="comment">/* IsInvEmpty – 有票标志，0为金税卡中无可开发票，1为有票 */</span></span><br><span class="line">            IsRepReached: goldTax.card.IsRepReached, <span class="comment">/* IsRepReached – 抄税标志，0为未到抄税期，1为已到抄税期 */</span></span><br><span class="line">            IsLockReached: goldTax.card.IsLockReached, <span class="comment">/* IsLockReached – 锁死标志，0为未到锁死期，1为已到锁死期 */</span></span><br><span class="line">            &#125;;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result.success = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            result.success = <span class="literal">false</span>;</span><br><span class="line">            result.code = <span class="number">-1</span>;</span><br><span class="line">            result.msg = <span class="string">'ActiveX Error, '</span> + e.description;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭金税盘</span></span><br><span class="line"><span class="comment">     * @return</span></span><br><span class="line"><span class="comment">     * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *        'success': true/false, // 成功或者失败</span></span><br><span class="line"><span class="comment"> *        'code': -1/其他, // 错误码，-1 为系统错误</span></span><br><span class="line"><span class="comment"> *        'msg': 'xxx' // 错误信息</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    closeCard: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = &#123;</span><br><span class="line"><span class="string">'success'</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">'code'</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="string">'msg'</span>: <span class="string">''</span></span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> goldTax.card != <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    goldTax.card.closeCard();</span><br><span class="line">    result.code = goldTax.card.RetCode;</span><br><span class="line">            result.msg = goldTax.card.RetMsg;</span><br><span class="line">    <span class="comment">// RetCode 9000 调用成功，其他失败</span></span><br><span class="line">    <span class="keyword">if</span> (result.code == <span class="number">9000</span>) &#123;</span><br><span class="line">    result.success = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result.success = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    result.success = <span class="literal">false</span>;</span><br><span class="line">            result.code = <span class="number">-1</span>;</span><br><span class="line">            result.msg = <span class="string">'ActiveX Error, '</span> + e.description;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询库存发票</span></span><br><span class="line"><span class="comment">     * @param invKind 发票种类</span></span><br><span class="line"><span class="comment">  * @return </span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *        'success': true/false, // 成功或者失败</span></span><br><span class="line"><span class="comment"> *        'code': -1/其他, // 错误码，-1 为系统错误</span></span><br><span class="line"><span class="comment"> *        'msg': 'xxx', // 错误信息</span></span><br><span class="line"><span class="comment"> *        'data': &#123;&#125; // 接口返回相关数据</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    invoiceInventory: <span class="function"><span class="keyword">function</span>(<span class="params">invKind</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = &#123;</span><br><span class="line"><span class="string">'success'</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">'code'</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="string">'msg'</span>: <span class="string">''</span>,</span><br><span class="line"><span class="string">'data'</span>: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> goldTax.card != <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    goldTax.card.InfoKind = invKind;</span><br><span class="line">    goldTax.card.GetInfo();</span><br><span class="line">    result.code = goldTax.card.RetCode;</span><br><span class="line">            result.msg = goldTax.card.RetMsg;</span><br><span class="line">    <span class="comment">// RetCode 3011 读取成功，其他失败</span></span><br><span class="line">    <span class="keyword">if</span> (result.code == <span class="number">3011</span>) &#123;</span><br><span class="line">    result.success = <span class="literal">true</span>;</span><br><span class="line">    result.data = &#123;</span><br><span class="line">    RetCode: goldTax.card.RetCode, <span class="comment">/* RetCode - 状态码， 3011 读取成功，其他失败 */</span></span><br><span class="line">            RetMsg: goldTax.card.RetMsg, <span class="comment">/* RetMsg 状态信息 */</span></span><br><span class="line">            InfoTypeCode: goldTax.card.InfoTypeCode, <span class="comment">/* 要开具发票的十位代码。为空或全为0时，表示无可用发票 */</span></span><br><span class="line">            InfoNumber: goldTax.card.InfoNumber, <span class="comment">/* 要开具发票的号码 */</span></span><br><span class="line">            InvStock: goldTax.card.InvStock, <span class="comment">/* 剩余的可用发票份数 */</span></span><br><span class="line">            TaxClock: goldTax.card.TaxClock <span class="comment">/* 金税盘时钟 */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result.success = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result.success = <span class="literal">false</span>;</span><br><span class="line">            result.code = <span class="number">-1</span>;</span><br><span class="line">            result.msg = <span class="string">'Please Open Card First'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">result.success = <span class="literal">false</span>;</span><br><span class="line">            result.code = <span class="number">-1</span>;</span><br><span class="line">            result.msg = <span class="string">'ActiveX Error, '</span> + e.description;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发票校验</span></span><br><span class="line"><span class="comment">     * @param o 传入发票信息</span></span><br><span class="line"><span class="comment">     * @return </span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *        'success': true/false, // 成功或者失败</span></span><br><span class="line"><span class="comment"> *        'code': -1/其他, // 错误码，-1 为系统错误</span></span><br><span class="line"><span class="comment"> *        'msg': 'xxx', // 错误信息</span></span><br><span class="line"><span class="comment"> *        'data': &#123;&#125; // 接口返回相关数据</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">    invoiceVeriferify: <span class="function"><span class="keyword">function</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> goldTax.inner.invoice(<span class="number">1</span>, o);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发票开具</span></span><br><span class="line"><span class="comment">     * @param o 传入发票信息</span></span><br><span class="line"><span class="comment">     * @return </span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *        'success': true/false, // 成功或者失败</span></span><br><span class="line"><span class="comment"> *        'code': -1/其他, // 错误码，-1 为系统错误</span></span><br><span class="line"><span class="comment"> *        'msg': 'xxx', // 错误信息</span></span><br><span class="line"><span class="comment"> *        'data': &#123;&#125; // 接口返回相关数据</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">    invoicing: <span class="function"><span class="keyword">function</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> goldTax.inner.invoice(<span class="number">0</span>, o);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发票打印</span></span><br><span class="line"><span class="comment">     * @param o 传入发票信息</span></span><br><span class="line"><span class="comment">     * @return </span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *        'success': true/false, // 成功或者失败</span></span><br><span class="line"><span class="comment"> *        'code': -1/其他, // 错误码，-1 为系统错误</span></span><br><span class="line"><span class="comment"> *        'msg': 'xxx' // 错误信息</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">    printInv: <span class="function"><span class="keyword">function</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = &#123;</span><br><span class="line"><span class="string">'success'</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">'code'</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="string">'msg'</span>: <span class="string">''</span></span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> goldTax.card != <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    goldTax.card.InfoKind = o.InfoKind; <span class="comment">/* 发票种类（0：专用发票  2：普通发票  11：货物运输业增值税专用发票  12：机动车销售统一发票） */</span></span><br><span class="line">    goldTax.card.InfoTypeCode = o.InfoTypeCode; <span class="comment">/* 要打印发票的十位代码 */</span></span><br><span class="line">                goldTax.card.InfoNumber = o.InfoNumber; <span class="comment">/* 要打印发票的号码 */</span></span><br><span class="line">                goldTax.card.GoodsListFlag = o.GoodsListFlag; <span class="comment">/* 销货清单标志，0 – 打印发票，1 – 打印销货清单 */</span></span><br><span class="line">                goldTax.card.InfoShowPrtDlg = o.InfoShowPrtDlg; <span class="comment">/* 打印时是否显示边距确认对话框，0 – 不出现，1 – 出现 */</span></span><br><span class="line">                <span class="comment">// 调用接口</span></span><br><span class="line">    goldTax.card.PrintInv();</span><br><span class="line">    result.code = goldTax.card.RetCode;</span><br><span class="line">            result.msg = goldTax.card.RetMsg;</span><br><span class="line">    <span class="comment">// RetCode 5011 打印成功，5001 – 未找到发票或清单，5012 – 未打印，5013 – 打印失败</span></span><br><span class="line">    <span class="keyword">if</span> (result.code == <span class="number">5011</span>) &#123;</span><br><span class="line">    result.success = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result.success = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result.success = <span class="literal">false</span>;</span><br><span class="line">            result.code = <span class="number">-1</span>;</span><br><span class="line">            result.msg = <span class="string">'Please Open Card First'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            result.success = <span class="literal">false</span>;</span><br><span class="line">            result.code = <span class="number">-1</span>;</span><br><span class="line">            result.msg = <span class="string">'ActiveX Error, '</span> + e.description;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 已开发票作废</span></span><br><span class="line"><span class="comment">     * @param o 传入发票信息</span></span><br><span class="line"><span class="comment">     * @return </span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *        'success': true/false, // 成功或者失败</span></span><br><span class="line"><span class="comment"> *        'code': -1/其他, // 错误码，-1 为系统错误</span></span><br><span class="line"><span class="comment"> *        'msg': 'xxx' // 错误信息</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">    cancelInv: <span class="function"><span class="keyword">function</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = &#123;</span><br><span class="line"><span class="string">'success'</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">'code'</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="string">'msg'</span>: <span class="string">''</span></span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> goldTax.card != <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    goldTax.card.InfoKind = o.InfoKind; <span class="comment">/* 发票种类（0：专用发票  2：普通发票  11：货物运输业增值税专用发票  12：机动车销售统一发票） */</span></span><br><span class="line">    goldTax.card.InfoTypeCode = o.InfoTypeCode; <span class="comment">/* 要作废发票的十位或十二位代码 */</span></span><br><span class="line">                goldTax.card.InfoNumber = o.InfoNumber; <span class="comment">/* 要作废发票的号码 */</span></span><br><span class="line">                <span class="comment">// 调用接口</span></span><br><span class="line">    goldTax.card.CancelInv();</span><br><span class="line">    result.code = goldTax.card.RetCode;</span><br><span class="line">            result.msg = goldTax.card.RetMsg;</span><br><span class="line">    <span class="comment">// RetCode 6011 打印成功，6001 – 当月发票库未找到该发票，6002 – 该发票已经作废，6012 – 作废失败，6013 – 作废失败(异常)</span></span><br><span class="line">    <span class="keyword">if</span> (result.code == <span class="number">6011</span>) &#123;</span><br><span class="line">    result.success = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result.success = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result.success = <span class="literal">false</span>;</span><br><span class="line">            result.code = <span class="number">-1</span>;</span><br><span class="line">            result.msg = <span class="string">'Please Open Card First'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            result.success = <span class="literal">false</span>;</span><br><span class="line">            result.code = <span class="number">-1</span>;</span><br><span class="line">            result.msg = <span class="string">'ActiveX Error, '</span> + e.description;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 内部方法</span></span><br><span class="line">    inner: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * invoice 接口</span></span><br><span class="line"><span class="comment">     * @param checkEWM 默认为0（0: 发票开具, 1: 发票校验, 2: 空白作废)</span></span><br><span class="line"><span class="comment">     * @param o 传入发票信息</span></span><br><span class="line"><span class="comment">     * @return </span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *        'success': true/false, // 成功或者失败</span></span><br><span class="line"><span class="comment"> *        'code': -1/其他, // 错误码，-1 为系统错误</span></span><br><span class="line"><span class="comment"> *        'msg': 'xxx', // 错误信息</span></span><br><span class="line"><span class="comment"> *        'data': &#123;&#125; // 接口返回相关数据</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">    invoice: <span class="function"><span class="keyword">function</span>(<span class="params">checkEWM, o</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = &#123;</span><br><span class="line"><span class="string">'success'</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">'code'</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="string">'msg'</span>: <span class="string">''</span>,</span><br><span class="line"><span class="string">'data'</span>: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> goldTax.card != <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="comment">// CheckEWM值默认为0（为1时用于发票校验。</span></span><br><span class="line">    <span class="comment">// 注意：一旦CheckEWM值置1用于发票校验之后，</span></span><br><span class="line">    <span class="comment">//如果要再进行发票开具必须手动将CheckEWM值置为0，否则Invoice()方法的功能将一直处于发票校验状态）</span></span><br><span class="line">    goldTax.card.CheckEWM = checkEWM; </span><br><span class="line">    goldTax.card.InvInfoInit(); <span class="comment">/* 初始化发票抬头信息 */</span></span><br><span class="line">    goldTax.card.InfoKind = o.InfoKind; <span class="comment">/* 增值税普通发票2 专票0 */</span></span><br><span class="line">    goldTax.card.InfoClientName = o.InfoClientName; <span class="comment">/* 购方名称 */</span></span><br><span class="line">                goldTax.card.InfoClientTaxCode = o.InfoClientTaxCode; <span class="comment">/* 购方税号 */</span></span><br><span class="line">                goldTax.card.InfoClientBankAccount = o.InfoClientBankAccount; <span class="comment">/* 购方开户行及账号 */</span></span><br><span class="line">                goldTax.card.InfoClientAddressPhone = o.InfoClientAddressPhone; <span class="comment">/* 购方地址电话 */</span></span><br><span class="line">                goldTax.card.InfoSellerBankAccount = o.InfoSellerBankAccount; <span class="comment">/* 销方开户行及账号 */</span></span><br><span class="line">                goldTax.card.InfoSellerAddressPhone = o.InfoSellerAddressPhone; <span class="comment">/* 销方地址电话 */</span></span><br><span class="line">                <span class="comment">// 如果是多商品多税率 税率应该放到下面商品信息循环里</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> o.InfoTaxRate != <span class="string">'undefined'</span> &amp;&amp; o.InfoTaxRate) &#123; </span><br><span class="line">                goldTax.card.InfoTaxRate = o.InfoTaxRate; <span class="comment">/* 税率,(已授权的税率， 17% 传17) */</span></span><br><span class="line">                &#125;</span><br><span class="line">                goldTax.card.InfoNotes = o.InfoNotes; <span class="comment">/* 备注 */</span></span><br><span class="line">                goldTax.card.InfoInvoicer = o.InfoInvoicer; <span class="comment">/* 开票人 */</span></span><br><span class="line">                <span class="comment">// 复核人，可为空</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> o.InfoChecker != <span class="string">'undefined'</span> &amp;&amp; o.InfoChecker) &#123;</span><br><span class="line">                goldTax.card.InfoChecker = o.InfoChecker;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 收款人，可为空</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> o.InfoCashier != <span class="string">'undefined'</span> &amp;&amp; o.InfoCashier) &#123;</span><br><span class="line">                goldTax.card.InfoCashier = o.InfoCashier;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 如不为空，则开具销货清单，此为发票上商品名称栏的清单信息，应为“(详见销货清单)”字样</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> o.InfoListName != <span class="string">'undefined'</span> &amp;&amp; o.InfoListName) &#123; </span><br><span class="line">                goldTax.card.InfoListName = o.InfoListName;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 清空商品明细列表</span></span><br><span class="line">                goldTax.card.ClearInvList(); </span><br><span class="line">                <span class="comment">// 遍历行</span></span><br><span class="line">                $.each(o.InvList, <span class="function"><span class="keyword">function</span>(<span class="params">i, v</span>) </span>&#123;</span><br><span class="line">                goldTax.card.InvListInit(); <span class="comment">/* 初始化发票明细信息各项属性 */</span></span><br><span class="line">                goldTax.card.ListGoodsName = v.ListGoodsName; <span class="comment">/* 商品或劳务名称 */</span></span><br><span class="line">                goldTax.card.ListTaxItem = v.ListTaxItem; <span class="comment">/* 税目，4位数字，商品所属类别 */</span></span><br><span class="line">                goldTax.card.ListStandard = v.ListStandard; <span class="comment">/* 规格型号 */</span></span><br><span class="line">                <span class="comment">// 计量单位，如计量单位为空，则忽略数量和单价</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> v.ListUnit != <span class="string">'undefined'</span> &amp;&amp; v.ListUnit) &#123;</span><br><span class="line">                goldTax.card.ListUnit = v.ListUnit;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 建议传入数量和含税单价或含税金额 由接口计算带小数的税额 规避误差</span></span><br><span class="line">                goldTax.card.ListNumber = v.ListNumber; <span class="comment">// 数量</span></span><br><span class="line">                goldTax.card.ListPrice = v.ListPrice; <span class="comment">// 单价</span></span><br><span class="line">                <span class="comment">// 金额，可以不传(为0)，由接口软件计算，如传入则应符合计算关系</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> v.ListAmount != <span class="string">'undefined'</span> &amp;&amp; v.ListAmount ) &#123;</span><br><span class="line">                goldTax.card.ListAmount = v.ListAmount;</span><br><span class="line">                &#125;</span><br><span class="line">                goldTax.card.ListPriceKind = v.ListPriceKind; <span class="comment">/* 含税价标志，单价和金额的种类， 0为不含税价，1为含税价 */</span></span><br><span class="line">                <span class="comment">// 税额可以不传(为0)，由接口软件计算，如传入则应符合计算关系</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> v.ListTaxAmount != <span class="string">'undefined'</span> &amp;&amp; v.ListTaxAmount) &#123;</span><br><span class="line">                goldTax.card.ListTaxAmount = v.ListTaxAmount;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 添加一行</span></span><br><span class="line">                goldTax.card.AddInvList();</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 调用接口</span></span><br><span class="line">    goldTax.card.Invoice();</span><br><span class="line">    result.code = goldTax.card.RetCode;</span><br><span class="line">            result.msg = goldTax.card.RetMsg;</span><br><span class="line">    <span class="comment">// RetCode 4011 开票成功，其他失败</span></span><br><span class="line">    <span class="keyword">if</span> (result.code == <span class="number">4011</span>) &#123;</span><br><span class="line">    result.success = <span class="literal">true</span>;</span><br><span class="line">    result.data = &#123;</span><br><span class="line">    RetCode: goldTax.card.RetCode, <span class="comment">/* RetCode - 状态码， 3011 读取成功，其他失败 */</span></span><br><span class="line">            RetMsg: goldTax.card.RetMsg, <span class="comment">/* RetMsg 状态信息 */</span></span><br><span class="line">            InfoAmount: goldTax.card.InfoAmount , <span class="comment">/* 合计不含税金额 */</span></span><br><span class="line">            InfoTaxAmount: goldTax.card.InfoTaxAmount, <span class="comment">/* 合计税额 */</span></span><br><span class="line">            InfoInvDate: goldTax.card.InfoInvDate, <span class="comment">/* 开票日期 */</span></span><br><span class="line">            InfMonth: goldTax.card.InfMonth, <span class="comment">/* 所属月份 */</span></span><br><span class="line">            InfoTypeCode: goldTax.card.InfoTypeCode, <span class="comment">/* 发票十位代码 */</span></span><br><span class="line">            InfoNumber: goldTax.card.InfoNumber, <span class="comment">/* 发票号码 */</span></span><br><span class="line">            GoodsListFlag: goldTax.card.GoodsListFlag <span class="comment">/* 销货清单标志，0 – 无销货清单，1 – 有销货清单 */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result.success = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result.success = <span class="literal">false</span>;</span><br><span class="line">            result.code = <span class="number">-1</span>;</span><br><span class="line">            result.msg = <span class="string">'Please Open Card First'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            result.success = <span class="literal">false</span>;</span><br><span class="line">            result.code = <span class="number">-1</span>;</span><br><span class="line">            result.msg = <span class="string">'ActiveX Error, '</span> + e.description;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h3><p><code>CSDN</code> 需要积分下载 <a href="https://download.csdn.net/download/qq_36894469/9891113" target="_blank" rel="noopener">金税 防伪税控 组件接口 开发文档 代码案例</a></p><p>没有积分的 <a href="https://pan.baidu.com/s/11djfBHQMfhxpsLi3BqOOSA" target="_blank" rel="noopener">戳这里</a></p>]]></content>
    
    <summary type="html">
    
      最近项目要求与单机版的金税盘接口进行对接，在这里简单记录一下自己的开发经验，希望可以帮助到有需要的人
    
    </summary>
    
      <category term="随笔" scheme="http://yoursite.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="JavaScript" scheme="http://yoursite.com/tags/JavaScript/"/>
    
      <category term="ActiveX" scheme="http://yoursite.com/tags/ActiveX/"/>
    
      <category term="金税" scheme="http://yoursite.com/tags/%E9%87%91%E7%A8%8E/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yoursite.com/2018/08/20/hello-world/"/>
    <id>http://yoursite.com/2018/08/20/hello-world/</id>
    <published>2018-08-20T10:27:33.678Z</published>
    <updated>2018-08-20T12:41:36.121Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      Hello Word!
    
    </summary>
    
    
  </entry>
  
</feed>
